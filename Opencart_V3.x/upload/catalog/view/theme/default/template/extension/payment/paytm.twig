<script type="application/javascript" crossorigin="anonymous" src="{{ srcUrl }}" onload="alert('Script loaded!'); loaded=true;"></script>
<div class="buttons">

  <div class="pull-right">
    <input type="button" value="{{ button_confirm }}" onClick="openJsCheckout();" id="button-confirm" class="btn btn-primary" />
  </div>
  <span style="color:red;" id="paytmerror"><span>
  </div>
  <script type="text/javascript">
  function openJsCheckout(){
  document.getElementById("paytmerror").innerHTML="";
  var transactionToken = "{{ txnToken }}";
  if(transactionToken!=''){
   invokeBlinkCheckoutPopup("{{ txnToken }}", "{{ orderId }}", "{{ amount }}");
  }else{
  document.getElementById("paytmerror").innerHTML="{{ message }}";
  }
  }

 
  function invokeBlinkCheckoutPopup(txnToken, orderId, amount){
    //   console.log(txnToken, orderId, amount);
        var config = {
         "root": "",
         "flow": "DEFAULT",
         "data": {
          "orderId": orderId,
          "token": txnToken,
          "tokenType": "TXN_TOKEN",
          "amount": amount
         },
         "handler": {
            "notifyMerchant": function(eventName,data){
              if(eventName == 'SESSION_EXPIRED'){
                location.reload(); 
              }
            } 
          }
        };
      
        if(window.Paytm && window.Paytm.CheckoutJS){
                // initialze configuration using init method 
                window.Paytm.CheckoutJS.init(config).then(function onSuccess() {
                   // after successfully update configuration invoke checkoutjs
                   window.Paytm.CheckoutJS.invoke();
                }).catch(function onError(error){
                   // console.log("error => ",error);
                });
        } 
    }
</script>
